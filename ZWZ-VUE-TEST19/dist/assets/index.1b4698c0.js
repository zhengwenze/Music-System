import{aw as e,r as s,j as a,ac as r,y as l,D as o,G as n,E as t,F as i,am as u,S as d}from"./vendor.1112e821.js";import{_ as m,l as p,s as c,d as g}from"./index.cfbf38c0.js";import{E as f}from"./element-plus.c63ee1ff.js";import"./axios.468b7dd2.js";const v={class:"login-container"},w={class:"login-box"};var h=m({__name:"index",setup(m){const h=e(),_=s(null),y=s(!1),b=a({username:"",password:""}),x={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}]},k=async()=>{try{await _.value.validate(),y.value=!0;try{const e=await p({username:b.username,password:b.password}),s=e.data||e;if(20!==s.code&&!0!==s.success||!s.data)f.error(s.message||"登录失败，请检查用户名和密码");else{const e=s.data.user||{};if(0===e.activation)return void f.error("该账户已被冻结！");c({userId:e.id,username:e.username,role:void 0!==e.role?e.role.toString():"2",name:e.username,email:e.email||"",phone:e.phone||""});g().isComplete||(c({userId:e.id,username:e.username,role:void 0!==e.role?e.role.toString():"2",name:e.username,email:e.email||"",phone:e.phone||""}),g()),f.success(s.message||"登录成功"),setTimeout((()=>{let s="/login";const a=void 0!==e.role?parseInt(e.role):2;0===a?s="/admin/profile":1===a?s="/singer/profile":2===a&&(s="/user/profile"),h.push(s)}),500)}}catch(e){e instanceof TypeError?f.error("登录处理出错，请稍后重试"):f.error(e.message||"登录失败，请检查网络连接或联系管理员")}finally{y.value=!1}}catch(e){e&&e.password&&e.password.length>0?f.error("密码验证失败："+e.password[0]):e&&e.username&&e.username.length>0?f.error("用户名验证失败："+e.username[0]):f.error("表单验证失败，请检查输入"),y.value=!1}},V=()=>{h.push("/register")};return(e,s)=>{const a=r("el-input"),m=r("el-form-item"),p=r("el-button"),c=r("el-link"),g=r("el-col"),f=r("el-row"),h=r("el-form");return l(),o("div",v,[s[9]||(s[9]=n("div",{class:"background"},[n("div",{class:"shape"}),n("div",{class:"shape"})],-1)),n("div",w,[s[7]||(s[7]=n("div",{class:"login-title"},[n("h3",null,"Music Dreamer 悦享音乐")],-1)),t(h,{ref_key:"loginFormRef",ref:_,model:b,rules:x,class:"login-form",onKeyup:u(k,["enter"])},{default:i((()=>[s[5]||(s[5]=n("label",{for:"username"},"用户名",-1)),t(m,{prop:"username"},{default:i((()=>[t(a,{modelValue:b.username,"onUpdate:modelValue":s[0]||(s[0]=e=>b.username=e),placeholder:"请输入用户名",class:"glass-input"},null,8,["modelValue"])])),_:1}),s[6]||(s[6]=n("label",{for:"password"},"密码",-1)),t(m,{prop:"password"},{default:i((()=>[t(a,{modelValue:b.password,"onUpdate:modelValue":s[1]||(s[1]=e=>b.password=e),type:"password",placeholder:"请输入密码","show-password":"",class:"glass-input"},null,8,["modelValue"])])),_:1}),t(m,null,{default:i((()=>[t(p,{type:"primary",class:"login-button",loading:y.value,onClick:k},{default:i((()=>[...s[2]||(s[2]=[d(" 登录 ",-1)])])),_:1},8,["loading"])])),_:1}),t(m,null,{default:i((()=>[t(f,{gutter:20,class:"register-row"},{default:i((()=>[t(g,{span:24,class:"text-center"},{default:i((()=>[s[4]||(s[4]=n("span",null,"还没有账号? ",-1)),t(c,{type:"primary",onClick:V,class:"register-link"},{default:i((()=>[...s[3]||(s[3]=[d("立即注册",-1)])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),s[8]||(s[8]=n("div",{class:"login-footer"},[n("p",null,"© 2025 Music Dreamer 悦享音乐 版权所有")],-1))])])}}},[["__scopeId","data-v-a125a096"]]);export{h as default};
