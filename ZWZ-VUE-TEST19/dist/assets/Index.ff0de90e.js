import{_ as e,e as a}from"./index.cfbf38c0.js";import{aA as i,r as s,w as l,o as t,ac as n,ad as c,y as r,D as u,G as o,z as d,u as m,R as v,E as p,F as g,P as k,S as y,M as h,a5 as f,H as b,U as C,$ as _,am as w}from"./vendor.1112e821.js";import{g as z,a as N,r as L}from"./mylike.b9b8a089.js";import{g as S,a as x,b as I}from"./music.3b750384.js";import{l as U,E as j,m as A}from"./element-plus.c63ee1ff.js";import"./axios.468b7dd2.js";const V={class:"hot-music-container"},E={class:"rank-tabs"},T={class:"rank-content"},$={key:0,class:"loading-container"},P={key:1,class:"error-container"},W={key:2,class:"empty-container"},D={key:3,class:"music-list"},F=["onClick"],M=["onClick"],R=["src","alt"],G={class:"music-info"},H={class:"music-name"},K={class:"music-artist"},O={class:"music-stats"},Y={class:"music-actions"},q={class:"rank-content"},B={key:0,class:"loading-container"},J={key:1,class:"error-container"},Q={key:2,class:"empty-container"},X={key:3,class:"music-list"},Z=["onClick"],ee=["onClick"],ae=["src","alt"],ie={class:"music-info"},se={class:"music-name"},le={class:"music-artist"},te={class:"music-stats"},ne={class:"music-actions"},ce={class:"search-content"},re={class:"search-bar"},ue={key:0,class:"loading-container"},oe={key:1,class:"error-container"},de={key:2,class:"empty-container"},me={key:3,class:"music-list"},ve=["onClick"],pe={class:"rank-number"},ge=["onClick"],ke=["src","alt"],ye={class:"music-info"},he={class:"music-name"},fe={class:"music-artist"},be={class:"music-stats"},Ce={class:"music-actions"},_e={class:"pagination-container"},we={class:"singer-content"},ze={key:0,class:"loading-container"},Ne={key:1,class:"error-container"},Le={key:2,class:"empty-container"},Se={key:3,class:"singer-list"},xe=["onClick"],Ie=["src","alt"],Ue={class:"singer-info"},je={class:"singer-name"},Ae={class:"singer-about"},Ve={key:1},Ee="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png";var Te=e({__name:"Index",setup(e){const Te=i((()=>a((()=>import("./musicPlayer.10ac923a.js")),["assets/musicPlayer.10ac923a.js","assets/musicPlayer.78314e69.css","assets/index.cfbf38c0.js","assets/index.12a402db.css","assets/vendor.1112e821.js","assets/axios.468b7dd2.js","assets/element-plus.c63ee1ff.js"]))),$e=s([]),Pe=s([]),We=s(!1),De=s(""),Fe=s(""),Me=s(new Set),Re=s(!1),Ge=s("hot"),He=s([]),Ke=s(!1),Oe=s(""),Ye=s([]),qe=s(!1),Be=s(""),Je=s(""),Qe=s(1),Xe=s(10),Ze=s(0),ea=s(!1),aa=s(""),ia=s([]),sa=s(!1),la=s(1),ta=s(5),na=s(0);s(null);const ca=e=>e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:`/music/${e}`:Ee,ra=e=>e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:`/music/${e}`:"",ua=e=>"number"!=typeof e?"0":e>=1e4?(e/1e4).toFixed(1)+"万":e.toString(),oa=e=>{if(!e)return"";try{const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`}catch(a){return e}},da=async(e="hot")=>{We.value=!0,De.value="";try{ma();let a=(await S(e)).data.data.list;if(a.length>0){const i=a.map(((e,a)=>{if("object"!=typeof e||null===e)return null;const i=e.musicId||e.id||e.music_id;if(!i)return null;const s=void 0===e.isLike||0!==e.isLike&&1!==e.isLike?void 0===e.is_liked||0!==e.is_liked&&1!==e.is_liked?Me.value.has(i)?1:0:e.is_liked:e.isLike,l=e.imageUrl||e.img||e.image||e.cover,t=e.musicUrl||e.url;return{musicId:i,musicName:e.musicName||e.name||e.title||"未知歌曲",singer:e.singer||e.artist||e.singerName||"未知歌手",img:ca(l),url:ra(t),listenNumb:"number"==typeof e.listenNumb?e.listenNumb:"number"==typeof e.listenCount?e.listenCount:0,createTime:e.createTime||e.time||"",isLike:s,activation:e.activation||1,album:e.album||"",fromSinger:e.fromSinger||null}})).filter((e=>null!==e&&1===e.activation));"hot"===e?$e.value=i:Pe.value=i}else"hot"===e?$e.value=[]:Pe.value=[]}catch(a){De.value="加载失败，请稍后重试",j.error(`加载${"hot"===e?"热门":"最新"}音乐失败`);const i=[];"hot"===e?$e.value=i:Pe.value=i}finally{We.value=!1}},ma=async()=>{try{const e=await z();Me.value=new Set,Array.isArray(e)?e.forEach((e=>{const a=(null==e?void 0:e.id)||(null==e?void 0:e.musicId);a&&Me.value.add(a)})):e&&20===e.code&&Array.isArray(e.data)?e.data.forEach((e=>{const a=(null==e?void 0:e.id)||(null==e?void 0:e.musicId);a&&Me.value.add(a)})):e&&e.data&&e.data.data&&Array.isArray(e.data.data.likelist)?e.data.data.likelist.forEach((e=>{const a=(null==e?void 0:e.id)||(null==e?void 0:e.musicId);a&&Me.value.add(a)})):e&&e.success&&Array.isArray(e.data)&&e.data.forEach((e=>{const a=(null==e?void 0:e.id)||(null==e?void 0:e.musicId);a&&Me.value.add(a)}))}catch(e){Me.value=new Set}},va=async()=>{qe.value=!0,Be.value="";try{ma();const e=await x({page:Qe.value,size:Xe.value,keyword:Je.value});let a=[],i=0;a=e.data.data.page.records,i=e.data.data.page.total||0;const s=a.map(((e,a)=>{if("object"!=typeof e||null===e)return null;const i=e.musicId||e.id||e.music_id;if(!i)return null;const s=void 0===e.isLike||0!==e.isLike&&1!==e.isLike?void 0===e.is_liked||0!==e.is_liked&&1!==e.is_liked?Me.value.has(i)?1:0:e.is_liked:e.isLike,l=e.imageUrl||e.img||e.image||e.cover,t=e.musicUrl||e.url;return{musicId:i,musicName:e.musicName||e.name||e.title||"未知歌曲",singer:e.singer||e.artist||e.singerName||"未知歌手",img:ca(l),url:ra(t),listenNumb:"number"==typeof e.listenNumb?e.listenNumb:"number"==typeof e.listenCount?e.listenCount:0,createTime:e.createTime||e.time||"",isLike:s,activation:e.activation||1,album:e.album||""}})).filter((e=>null!==e));Ye.value=s,Ze.value=i}catch(e){Be.value="加载失败，请稍后重试",j.error("加载音乐搜索列表失败"),Ye.value=[],Ze.value=0}finally{qe.value=!1}},pa=e=>{e.url?0!==e.activation?(Fe.value=e.url,void 0!==e.listenNumb&&(e.listenNumb+=1),j.success(`正在播放: ${e.musicName}`)):j.error("这个歌曲已被下架，无法播放！"):j.warning("该歌曲暂无播放链接")},ga=async e=>{if(!Re.value){Re.value=!0;try{const a=e.musicId;if(!a)return void j.error("无效的音乐信息");if(1!==e.isLike){const i=await N(a);20===i.code||200===i.code||i&&i.success?(e.isLike=1,Me.value.add(a),j.success("收藏成功")):j.error("收藏失败，请稍后重试")}else{const i=await L(a);20===i.code||200===i.code||i&&i.success?(e.isLike=0,Me.value.delete(a),j.success("取消收藏成功")):j.error("取消收藏失败，请稍后重试")}}catch(a){j.error("操作失败，请稍后重试")}finally{Re.value=!1}}},ka=()=>{Qe.value=1,va()},ya=e=>{Xe.value=e,Qe.value=1,va()},ha=e=>{Qe.value=e,va()},fa=async()=>{Ke.value=!0,Oe.value="",He.value=[];try{const e=(await I()).data.data.list.map((e=>({id:e.id,username:e.username||"未知歌手",role:e.role,avatar:e.imageUrl,about:e.about})));He.value=e}catch(e){Oe.value="加载推荐歌手失败",j.error("加载推荐歌手失败，请稍后重试"),He.value=[{id:1,username:"周杰伦",role:"1",avatar:"https://example.com/avatar/1.jpg",about:"华语流行音乐天王"},{id:2,username:"陈奕迅",role:"1",avatar:"https://example.com/avatar/2.jpg",about:"香港流行音乐代表人物"}]}finally{Ke.value=!1}},ba=e=>{const a=Ge.value;"hot"===a||"newest"===a?da(a):"search"===a?(Qe.value=1,va()):"singer"===a&&0===He.value.length&&fa()};return l(Ge,((e,a)=>{"newest"===e?da("newest"):"search"===e?(Qe.value=1,va()):"singer"===e&&0===He.value.length&&fa()})),t((()=>{da("hot")})),(e,a)=>{const i=n("el-loading"),s=n("el-empty"),l=n("el-button"),t=n("el-input"),z=n("el-pagination"),N=n("el-table-column"),L=n("el-image"),S=n("el-table"),x=n("el-dialog"),I=c("loading");return r(),u("div",V,[a[17]||(a[17]=o("h2",{class:"page-title"},"热门推荐",-1)),Fe.value?(r(),d(m(Te),{key:0,"audio-url":Fe.value,autoplay:!0},null,8,["audio-url"])):v("",!0),o("div",E,[p(m(U),{modelValue:Ge.value,"onUpdate:modelValue":a[5]||(a[5]=e=>Ge.value=e),onTabClick:ba},{default:g((()=>[p(m(A),{label:"热门排行榜",name:"hot"},{default:g((()=>[o("div",T,[We.value?(r(),u("div",$,[k(p(i,{text:"加载中..."},null,512),[[I,We.value]])])):De.value?(r(),u("div",P,[p(s,{description:"加载失败","image-size":120}),p(l,{type:"primary",onClick:a[0]||(a[0]=e=>da("hot"))},{default:g((()=>[...a[9]||(a[9]=[y("重新加载",-1)])])),_:1})])):0===$e.value.length?(r(),u("div",W,[p(s,{description:"暂无热门音乐","image-size":120})])):(r(),u("div",D,[(r(!0),u(h,null,f($e.value,((e,i)=>(r(),u("div",{key:e.musicId||i,class:"music-item",onClick:a=>pa(e)},[o("div",{class:b(["rank-number",{top3:i<3}])},C(i+1),3),o("div",{class:"music-cover",onClick:_((a=>pa(e)),["stop"])},[o("img",{src:e.img||Ee,alt:e.musicName,class:"cover-image"},null,8,R),a[10]||(a[10]=o("div",{class:"play-icon"},[o("i",{class:"el-icon-play"})],-1))],8,M),o("div",G,[o("h3",H,C(e.musicName||"未知歌曲"),1),o("p",K,C(e.singer||"未知歌手"),1),o("p",O,C(ua(e.listenNumb))+" 次播放",1)]),o("div",Y,[p(l,{type:"text",icon:1===e.isLike?"el-icon-star-on":"el-icon-star-off",onClick:_((a=>ga(e)),["stop"]),class:b({liked:1===e.isLike}),disabled:Re.value},{default:g((()=>[y(C(1===e.isLike?"已收藏":"收藏"),1)])),_:2},1032,["icon","onClick","class","disabled"])])],8,F)))),128))]))])])),_:1}),p(m(A),{label:"最新排行榜",name:"newest"},{default:g((()=>[o("div",q,[We.value?(r(),u("div",B,[k(p(i,{text:"加载中..."},null,512),[[I,We.value]])])):De.value?(r(),u("div",J,[p(s,{description:"加载失败","image-size":120}),p(l,{type:"primary",onClick:a[1]||(a[1]=e=>da("newest"))},{default:g((()=>[...a[11]||(a[11]=[y("重新加载",-1)])])),_:1})])):0===Pe.value.length?(r(),u("div",Q,[p(s,{description:"暂无最新音乐","image-size":120})])):(r(),u("div",X,[(r(!0),u(h,null,f(Pe.value,((e,i)=>(r(),u("div",{key:e.musicId||i,class:"music-item",onClick:a=>pa(e)},[o("div",{class:b(["rank-number",{top3:i<3}])},C(i+1),3),o("div",{class:"music-cover",onClick:_((a=>pa(e)),["stop"])},[o("img",{src:e.img||Ee,alt:e.musicName,class:"cover-image"},null,8,ae),a[12]||(a[12]=o("div",{class:"play-icon"},[o("i",{class:"el-icon-play"})],-1))],8,ee),o("div",ie,[o("h3",se,C(e.musicName||"未知歌曲"),1),o("p",le,C(e.singer||"未知歌手"),1),o("p",te,C(oa(e.createTime)),1)]),o("div",ne,[p(l,{type:"text",icon:1===e.isLike?"el-icon-star-on":"el-icon-star-off",onClick:_((a=>ga(e)),["stop"]),class:b({liked:1===e.isLike}),disabled:Re.value},{default:g((()=>[y(C(1===e.isLike?"已收藏":"收藏"),1)])),_:2},1032,["icon","onClick","class","disabled"])])],8,Z)))),128))]))])])),_:1}),p(m(A),{label:"音乐搜索",name:"search"},{default:g((()=>[o("div",ce,[o("div",re,[p(t,{modelValue:Je.value,"onUpdate:modelValue":a[2]||(a[2]=e=>Je.value=e),placeholder:"搜索歌曲名称",clearable:"",onKeyup:w(ka,["enter"])},{append:g((()=>[p(l,{onClick:ka},{default:g((()=>[...a[13]||(a[13]=[y("搜索",-1)])])),_:1})])),_:1},8,["modelValue"])]),qe.value?(r(),u("div",ue,[k(p(i,{text:"加载中..."},null,512),[[I,qe.value]])])):Be.value?(r(),u("div",oe,[p(s,{description:"加载失败","image-size":120}),p(l,{type:"primary",onClick:va},{default:g((()=>[...a[14]||(a[14]=[y("重新加载",-1)])])),_:1})])):0===Ye.value.length?(r(),u("div",de,[p(s,{description:"暂无搜索结果","image-size":120})])):(r(),u("div",me,[(r(!0),u(h,null,f(Ye.value,((e,i)=>(r(),u("div",{key:e.musicId||i,class:"music-item",onClick:a=>pa(e)},[o("div",pe,C(i+1),1),o("div",{class:"music-cover",onClick:_((a=>pa(e)),["stop"])},[o("img",{src:e.img||Ee,alt:e.musicName,class:"cover-image"},null,8,ke),a[15]||(a[15]=o("div",{class:"play-icon"},[o("i",{class:"el-icon-play"})],-1))],8,ge),o("div",ye,[o("h3",he,C(e.musicName||"未知歌曲"),1),o("p",fe,C(e.singer||"未知歌手"),1),o("p",be,C(ua(e.listenNumb))+" 次播放",1)]),o("div",Ce,[p(l,{type:"text",icon:1===e.isLike?"el-icon-star-on":"el-icon-star-off",onClick:_((a=>ga(e)),["stop"]),class:b({liked:1===e.isLike}),disabled:Re.value},{default:g((()=>[y(C(1===e.isLike?"已收藏":"收藏"),1)])),_:2},1032,["icon","onClick","class","disabled"])])],8,ve)))),128))])),o("div",_e,[p(z,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:Ze.value,"current-page":Qe.value,"onUpdate:currentPage":a[3]||(a[3]=e=>Qe.value=e),"page-size":Xe.value,"onUpdate:pageSize":a[4]||(a[4]=e=>Xe.value=e),onSizeChange:ya,onCurrentChange:ha,"page-sizes":[5,10,20,50,100]},null,8,["total","current-page","page-size"])])])])),_:1}),p(m(A),{label:"推荐歌手",name:"singer"},{default:g((()=>[o("div",we,[Ke.value?(r(),u("div",ze,[k(p(i,{text:"加载中..."},null,512),[[I,Ke.value]])])):Oe.value?(r(),u("div",Ne,[p(s,{description:"加载失败","image-size":120}),p(l,{type:"primary",onClick:fa},{default:g((()=>[...a[16]||(a[16]=[y("重新加载",-1)])])),_:1})])):0===He.value.length?(r(),u("div",Le,[p(s,{description:"暂无推荐歌手","image-size":120})])):(r(),u("div",Se,[(r(!0),u(h,null,f(He.value,(a=>(r(),u("div",{key:a.id,class:"singer-item"},[o("div",{class:"singer-avatar",onClick:i=>e.openSingerSongPopup(a.id,a.username)},[o("img",{src:ca(a.avatar),alt:a.username,class:"avatar-image"},null,8,Ie)],8,xe),o("div",Ue,[o("h3",je,C(a.username||"未知歌手"),1),o("p",Ae,C(a.about||"暂无简介"),1)])])))),128))]))])])),_:1})])),_:1},8,["modelValue"])]),p(x,{modelValue:ea.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ea.value=e),title:aa.value,width:"800px"},{default:g((()=>[k((r(),d(S,{data:ia.value,style:{"margin-top":"20px","margin-left":"auto","margin-right":"auto"},"default-sort":{prop:"musicId",order:"ascending"}},{default:g((()=>[p(N,{prop:"musicId",label:"ID",width:"50"}),p(N,{prop:"musicName",label:"音乐名称",width:"150"}),p(N,{label:"音乐封面",width:"150"},{default:g((({row:e})=>[e.imageUrl?(r(),d(L,{key:0,src:e.imageUrl,"preview-src-list":[e.imageUrl],fit:"cover",style:{width:"80px",height:"80px","border-radius":"4px"}},null,8,["src","preview-src-list"])):(r(),u("span",Ve,"-"))])),_:1}),p(N,{label:"歌手",width:"120"},{default:g((({row:e})=>[y(C(e.singerUsername||"-"),1)])),_:1}),p(N,{prop:"tags",label:"标签",width:"150","show-overflow-tooltip":""}),p(N,{prop:"createTime",label:"创建时间",width:"160"})])),_:1},8,["data"])),[[I,sa.value]]),p(z,{"current-page":la.value,"onUpdate:currentPage":a[6]||(a[6]=e=>la.value=e),"page-size":ta.value,"onUpdate:pageSize":a[7]||(a[7]=e=>ta.value=e),"page-sizes":[5,10,20,50,100],total:na.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:e.handleSingerSongSizeChange,onCurrentChange:e.handleSingerSongCurrentChange,style:{"margin-top":"20px","justify-content":"center"}},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-691816b6"]]);export{Te as default};
