import{_ as a,e}from"./index.cfbf38c0.js";import{aA as s,r as i,w as l,o as t,ac as c,ad as n,y as u,D as r,G as o,z as d,u as m,R as v,E as p,F as g,P as k,S as y,M as f,a5 as h,H as b,U as _,$ as C,am as L}from"./vendor.1112e821.js";import{g as N,a as w,r as z}from"./mylike.b9b8a089.js";import{g as x,a as I,b as S}from"./music.3b750384.js";import{l as j,E as A,m as U}from"./element-plus.c63ee1ff.js";import"./axios.468b7dd2.js";const E={class:"hot-music-container"},$={class:"rank-tabs"},T={class:"rank-content"},V={key:0,class:"loading-container"},W={key:1,class:"error-container"},D={key:2,class:"empty-container"},P={key:3,class:"music-list"},F=["onClick"],M=["onClick"],R=["src","alt"],G={class:"music-info"},H={class:"music-name"},K={class:"music-artist"},O={class:"music-stats"},Y={class:"music-actions"},q={class:"rank-content"},B={key:0,class:"loading-container"},J={key:1,class:"error-container"},Q={key:2,class:"empty-container"},X={key:3,class:"music-list"},Z=["onClick"],aa=["onClick"],ea=["src","alt"],sa={class:"music-info"},ia={class:"music-name"},la={class:"music-artist"},ta={class:"music-stats"},ca={class:"music-actions"},na={class:"search-content"},ua={class:"search-bar"},ra={key:0,class:"loading-container"},oa={key:1,class:"error-container"},da={key:2,class:"empty-container"},ma={key:3,class:"music-list"},va=["onClick"],pa={class:"rank-number"},ga=["onClick"],ka=["src","alt"],ya={class:"music-info"},fa={class:"music-name"},ha={class:"music-artist"},ba={class:"music-stats"},_a={class:"music-actions"},Ca={class:"pagination-container"},La={class:"singer-content"},Na={key:0,class:"loading-container"},wa={key:1,class:"error-container"},za={key:2,class:"empty-container"},xa={key:3,class:"singer-list"},Ia={class:"singer-avatar"},Sa=["src","alt"],ja={class:"singer-info"},Aa={class:"singer-name"},Ua={class:"singer-about"},Ea="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png";var $a=a({__name:"Index",setup(a){const $a=s((()=>e((()=>import("./musicPlayer.10ac923a.js")),["assets/musicPlayer.10ac923a.js","assets/musicPlayer.78314e69.css","assets/index.cfbf38c0.js","assets/index.12a402db.css","assets/vendor.1112e821.js","assets/axios.468b7dd2.js","assets/element-plus.c63ee1ff.js"]))),Ta=i([]),Va=i([]),Wa=i(!1),Da=i(""),Pa=i(""),Fa=i(new Set),Ma=i(!1),Ra=i("hot"),Ga=i([]),Ha=i(!1),Ka=i(""),Oa=i([]),Ya=i(!1),qa=i(""),Ba=i(""),Ja=i(1),Qa=i(10),Xa=i(0),Za=a=>a?a.startsWith("http://")||a.startsWith("https://")||a.startsWith("/")?a:`/music/${a}`:Ea,ae=a=>a?a.startsWith("http://")||a.startsWith("https://")||a.startsWith("/")?a:`/music/${a}`:"",ee=a=>"number"!=typeof a?"0":a>=1e4?(a/1e4).toFixed(1)+"万":a.toString(),se=a=>{if(!a)return"";try{const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}catch(e){return a}},ie=async(a="hot")=>{Wa.value=!0,Da.value="";try{le();let e=(await x(a)).data.data.list;if(e.length>0){const s=e.map(((a,e)=>{if("object"!=typeof a||null===a)return null;const s=a.musicId||a.id||a.music_id;if(!s)return null;const i=void 0===a.isLike||0!==a.isLike&&1!==a.isLike?void 0===a.is_liked||0!==a.is_liked&&1!==a.is_liked?Fa.value.has(s)?1:0:a.is_liked:a.isLike,l=a.imageUrl||a.img||a.image||a.cover,t=a.musicUrl||a.url;return{musicId:s,musicName:a.musicName||a.name||a.title||"未知歌曲",singer:a.singer||a.artist||a.singerName||"未知歌手",img:Za(l),url:ae(t),listenNumb:"number"==typeof a.listenNumb?a.listenNumb:"number"==typeof a.listenCount?a.listenCount:0,createTime:a.createTime||a.time||"",isLike:i,activation:a.activation||1,album:a.album||"",fromSinger:a.fromSinger||null}})).filter((a=>null!==a&&1===a.activation));"hot"===a?Ta.value=s:Va.value=s}else"hot"===a?Ta.value=[]:Va.value=[]}catch(e){Da.value="加载失败，请稍后重试",A.error(`加载${"hot"===a?"热门":"最新"}音乐失败`);const s=[];"hot"===a?Ta.value=s:Va.value=s}finally{Wa.value=!1}},le=async()=>{try{const a=await N();Fa.value=new Set,Array.isArray(a)?a.forEach((a=>{const e=(null==a?void 0:a.id)||(null==a?void 0:a.musicId);e&&Fa.value.add(e)})):a&&20===a.code&&Array.isArray(a.data)?a.data.forEach((a=>{const e=(null==a?void 0:a.id)||(null==a?void 0:a.musicId);e&&Fa.value.add(e)})):a&&a.data&&a.data.data&&Array.isArray(a.data.data.likelist)?a.data.data.likelist.forEach((a=>{const e=(null==a?void 0:a.id)||(null==a?void 0:a.musicId);e&&Fa.value.add(e)})):a&&a.success&&Array.isArray(a.data)&&a.data.forEach((a=>{const e=(null==a?void 0:a.id)||(null==a?void 0:a.musicId);e&&Fa.value.add(e)}))}catch(a){Fa.value=new Set}},te=async()=>{Ya.value=!0,qa.value="";try{le();const a=await I({page:Ja.value,size:Qa.value,keyword:Ba.value});let e=[],s=0;e=a.data.data.page.records,s=a.data.data.page.total||0;const i=e.map(((a,e)=>{if("object"!=typeof a||null===a)return null;const s=a.musicId||a.id||a.music_id;if(!s)return null;const i=void 0===a.isLike||0!==a.isLike&&1!==a.isLike?void 0===a.is_liked||0!==a.is_liked&&1!==a.is_liked?Fa.value.has(s)?1:0:a.is_liked:a.isLike,l=a.imageUrl||a.img||a.image||a.cover,t=a.musicUrl||a.url;return{musicId:s,musicName:a.musicName||a.name||a.title||"未知歌曲",singer:a.singer||a.artist||a.singerName||"未知歌手",img:Za(l),url:ae(t),listenNumb:"number"==typeof a.listenNumb?a.listenNumb:"number"==typeof a.listenCount?a.listenCount:0,createTime:a.createTime||a.time||"",isLike:i,activation:a.activation||1,album:a.album||""}})).filter((a=>null!==a));Oa.value=i,Xa.value=s}catch(a){qa.value="加载失败，请稍后重试",A.error("加载音乐搜索列表失败"),Oa.value=[],Xa.value=0}finally{Ya.value=!1}},ce=a=>{a.url?0!==a.activation?(Pa.value=a.url,void 0!==a.listenNumb&&(a.listenNumb+=1),A.success(`正在播放: ${a.musicName}`)):A.error("这个歌曲已被下架，无法播放！"):A.warning("该歌曲暂无播放链接")},ne=async a=>{if(!Ma.value){Ma.value=!0;try{const e=a.musicId;if(!e)return void A.error("无效的音乐信息");if(1!==a.isLike){const s=await w(e);20===s.code||200===s.code||s&&s.success?(a.isLike=1,Fa.value.add(e),A.success("收藏成功")):A.error("收藏失败，请稍后重试")}else{const s=await z(e);20===s.code||200===s.code||s&&s.success?(a.isLike=0,Fa.value.delete(e),A.success("取消收藏成功")):A.error("取消收藏失败，请稍后重试")}}catch(e){A.error("操作失败，请稍后重试")}finally{Ma.value=!1}}},ue=()=>{Ja.value=1,te()},re=a=>{Qa.value=a,Ja.value=1,te()},oe=a=>{Ja.value=a,te()},de=async()=>{Ha.value=!0,Ka.value="",Ga.value=[];try{const a=(await S()).data.data.list.map((a=>({id:a.id,username:a.username||"未知歌手",role:a.role,avatar:a.imageUrl,about:a.about})));Ga.value=a}catch(a){Ka.value="加载推荐歌手失败",A.error("加载推荐歌手失败，请稍后重试"),Ga.value=[{id:1,username:"周杰伦",role:"1",avatar:"https://example.com/avatar/1.jpg",about:"华语流行音乐天王"},{id:2,username:"陈奕迅",role:"1",avatar:"https://example.com/avatar/2.jpg",about:"香港流行音乐代表人物"}]}finally{Ha.value=!1}},me=a=>{const e=Ra.value;"hot"===e||"newest"===e?ie(e):"search"===e?(Ja.value=1,te()):"singer"===e&&0===Ga.value.length&&de()};return l(Ra,((a,e)=>{"newest"===a?ie("newest"):"search"===a?(Ja.value=1,te()):"singer"===a&&0===Ga.value.length&&de()})),t((()=>{ie("hot")})),(a,e)=>{const s=c("el-loading"),i=c("el-empty"),l=c("el-button"),t=c("el-input"),N=c("el-pagination"),w=n("loading");return u(),r("div",E,[e[14]||(e[14]=o("h2",{class:"page-title"},"热门推荐",-1)),Pa.value?(u(),d(m($a),{key:0,"audio-url":Pa.value,autoplay:!0},null,8,["audio-url"])):v("",!0),o("div",$,[p(m(j),{modelValue:Ra.value,"onUpdate:modelValue":e[5]||(e[5]=a=>Ra.value=a),onTabClick:me},{default:g((()=>[p(m(U),{label:"热门排行榜",name:"hot"},{default:g((()=>[o("div",T,[Wa.value?(u(),r("div",V,[k(p(s,{text:"加载中..."},null,512),[[w,Wa.value]])])):Da.value?(u(),r("div",W,[p(i,{description:"加载失败","image-size":120}),p(l,{type:"primary",onClick:e[0]||(e[0]=a=>ie("hot"))},{default:g((()=>[...e[6]||(e[6]=[y("重新加载",-1)])])),_:1})])):0===Ta.value.length?(u(),r("div",D,[p(i,{description:"暂无热门音乐","image-size":120})])):(u(),r("div",P,[(u(!0),r(f,null,h(Ta.value,((a,s)=>(u(),r("div",{key:a.musicId||s,class:"music-item",onClick:e=>ce(a)},[o("div",{class:b(["rank-number",{top3:s<3}])},_(s+1),3),o("div",{class:"music-cover",onClick:C((e=>ce(a)),["stop"])},[o("img",{src:a.img||Ea,alt:a.musicName,class:"cover-image"},null,8,R),e[7]||(e[7]=o("div",{class:"play-icon"},[o("i",{class:"el-icon-play"})],-1))],8,M),o("div",G,[o("h3",H,_(a.musicName||"未知歌曲"),1),o("p",K,_(a.singer||"未知歌手"),1),o("p",O,_(ee(a.listenNumb))+" 次播放",1)]),o("div",Y,[p(l,{type:"text",icon:1===a.isLike?"el-icon-star-on":"el-icon-star-off",onClick:C((e=>ne(a)),["stop"]),class:b({liked:1===a.isLike}),disabled:Ma.value},{default:g((()=>[y(_(1===a.isLike?"已收藏":"收藏"),1)])),_:2},1032,["icon","onClick","class","disabled"])])],8,F)))),128))]))])])),_:1}),p(m(U),{label:"最新排行榜",name:"newest"},{default:g((()=>[o("div",q,[Wa.value?(u(),r("div",B,[k(p(s,{text:"加载中..."},null,512),[[w,Wa.value]])])):Da.value?(u(),r("div",J,[p(i,{description:"加载失败","image-size":120}),p(l,{type:"primary",onClick:e[1]||(e[1]=a=>ie("newest"))},{default:g((()=>[...e[8]||(e[8]=[y("重新加载",-1)])])),_:1})])):0===Va.value.length?(u(),r("div",Q,[p(i,{description:"暂无最新音乐","image-size":120})])):(u(),r("div",X,[(u(!0),r(f,null,h(Va.value,((a,s)=>(u(),r("div",{key:a.musicId||s,class:"music-item",onClick:e=>ce(a)},[o("div",{class:b(["rank-number",{top3:s<3}])},_(s+1),3),o("div",{class:"music-cover",onClick:C((e=>ce(a)),["stop"])},[o("img",{src:a.img||Ea,alt:a.musicName,class:"cover-image"},null,8,ea),e[9]||(e[9]=o("div",{class:"play-icon"},[o("i",{class:"el-icon-play"})],-1))],8,aa),o("div",sa,[o("h3",ia,_(a.musicName||"未知歌曲"),1),o("p",la,_(a.singer||"未知歌手"),1),o("p",ta,_(se(a.createTime)),1)]),o("div",ca,[p(l,{type:"text",icon:1===a.isLike?"el-icon-star-on":"el-icon-star-off",onClick:C((e=>ne(a)),["stop"]),class:b({liked:1===a.isLike}),disabled:Ma.value},{default:g((()=>[y(_(1===a.isLike?"已收藏":"收藏"),1)])),_:2},1032,["icon","onClick","class","disabled"])])],8,Z)))),128))]))])])),_:1}),p(m(U),{label:"音乐搜索",name:"search"},{default:g((()=>[o("div",na,[o("div",ua,[p(t,{modelValue:Ba.value,"onUpdate:modelValue":e[2]||(e[2]=a=>Ba.value=a),placeholder:"搜索歌曲名称",clearable:"",onKeyup:L(ue,["enter"])},{append:g((()=>[p(l,{onClick:ue},{default:g((()=>[...e[10]||(e[10]=[y("搜索",-1)])])),_:1})])),_:1},8,["modelValue"])]),Ya.value?(u(),r("div",ra,[k(p(s,{text:"加载中..."},null,512),[[w,Ya.value]])])):qa.value?(u(),r("div",oa,[p(i,{description:"加载失败","image-size":120}),p(l,{type:"primary",onClick:te},{default:g((()=>[...e[11]||(e[11]=[y("重新加载",-1)])])),_:1})])):0===Oa.value.length?(u(),r("div",da,[p(i,{description:"暂无搜索结果","image-size":120})])):(u(),r("div",ma,[(u(!0),r(f,null,h(Oa.value,((a,s)=>(u(),r("div",{key:a.musicId||s,class:"music-item",onClick:e=>ce(a)},[o("div",pa,_(s+1),1),o("div",{class:"music-cover",onClick:C((e=>ce(a)),["stop"])},[o("img",{src:a.img||Ea,alt:a.musicName,class:"cover-image"},null,8,ka),e[12]||(e[12]=o("div",{class:"play-icon"},[o("i",{class:"el-icon-play"})],-1))],8,ga),o("div",ya,[o("h3",fa,_(a.musicName||"未知歌曲"),1),o("p",ha,_(a.singer||"未知歌手"),1),o("p",ba,_(ee(a.listenNumb))+" 次播放",1)]),o("div",_a,[p(l,{type:"text",icon:1===a.isLike?"el-icon-star-on":"el-icon-star-off",onClick:C((e=>ne(a)),["stop"]),class:b({liked:1===a.isLike}),disabled:Ma.value},{default:g((()=>[y(_(1===a.isLike?"已收藏":"收藏"),1)])),_:2},1032,["icon","onClick","class","disabled"])])],8,va)))),128))])),o("div",Ca,[p(N,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:Xa.value,"current-page":Ja.value,"onUpdate:currentPage":e[3]||(e[3]=a=>Ja.value=a),"page-size":Qa.value,"onUpdate:pageSize":e[4]||(e[4]=a=>Qa.value=a),onSizeChange:re,onCurrentChange:oe,"page-sizes":[5,10,20,50,100]},null,8,["total","current-page","page-size"])])])])),_:1}),p(m(U),{label:"推荐歌手",name:"singer"},{default:g((()=>[o("div",La,[Ha.value?(u(),r("div",Na,[k(p(s,{text:"加载中..."},null,512),[[w,Ha.value]])])):Ka.value?(u(),r("div",wa,[p(i,{description:"加载失败","image-size":120}),p(l,{type:"primary",onClick:de},{default:g((()=>[...e[13]||(e[13]=[y("重新加载",-1)])])),_:1})])):0===Ga.value.length?(u(),r("div",za,[p(i,{description:"暂无推荐歌手","image-size":120})])):(u(),r("div",xa,[(u(!0),r(f,null,h(Ga.value,(a=>(u(),r("div",{key:a.id,class:"singer-item"},[o("div",Ia,[o("img",{src:Za(a.avatar),alt:a.username,class:"avatar-image"},null,8,Sa)]),o("div",ja,[o("h3",Aa,_(a.username||"未知歌手"),1),o("p",Ua,_(a.about||"暂无简介"),1)])])))),128))]))])])),_:1})])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-193d0d8f"]]);export{$a as default};
