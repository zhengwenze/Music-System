import{r as e,j as a,o as r,ac as l,ad as t,y as o,D as s,E as d,F as i,G as n,S as u,am as m,P as c,z as p,U as g,R as v}from"./vendor.1112e821.js";import{u as h}from"./admin.d2f1ae71.js";import{_ as f,i as w,r as y}from"./index.cfbf38c0.js";import{E as b,i as C}from"./element-plus.c63ee1ff.js";import"./axios.468b7dd2.js";const V={class:"user-management-container"},_={class:"card-header"},x={class:"search-box"},F={key:1},U={class:"dialog-footer"};var k=f({name:"UserManagement",setup(){const l=e([]),t=e(!1),o=e(0),s=e(1),d=e(5),i=e(""),n=e(!1),u=e(""),m=e(null),c=e(!1),p=a({id:null,username:"",email:"",phone:"",password:"",confirmPassword:"",role:"2",activation:"1"}),g=(e,a,r)=>{""===a?r(new Error("请输入密码")):(""!==p.confirmPassword&&m.value.validateField("confirmPassword"),r())},v=(e,a,r)=>{""===a?r(new Error("请再次输入密码")):a!==p.password?r(new Error("两次输入密码不一致!")):r()},f=a({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的手机号",trigger:"blur"}],password:[{required:!0,validator:g,trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,validator:v,trigger:"blur"}]}),V=async()=>{t.value=!0;try{const e=`/pageUser/1/${5*d.value}`,a=await w.get(e,{params:{keyword:i.value||""}});if(20===a.data.code||!0===a.data.success){let e=[];a.data.page&&a.data.page.records?e=a.data.page.records:a.data.data&&a.data.data.page&&a.data.data.page.records?e=a.data.data.page.records:a.data.records?e=a.data.records:Array.isArray(a.data)?e=a.data:a.data.list?e=a.data.list:a.data.data&&Array.isArray(a.data.data)&&(e=a.data.data);const r=e.filter((e=>e&&1===e.role));o.value=r.length;const t=(s.value-1)*d.value,i=t+d.value;if(l.value=r.slice(t,i),0===l.value.length&&o.value>0){const e=Math.ceil(o.value/d.value);if(e>0&&e!==s.value)return s.value=e,void(await V())}}else b.error(a.data.message||"获取歌手列表失败")}catch(e){b.error("获取歌手列表失败")}finally{t.value=!1}},_=()=>{p.id=null,p.username="",p.email="",p.phone="",p.password="",p.confirmPassword="",p.role="1",p.activation="1",m.value&&m.value.resetFields()};return r((()=>{V()})),{userList:l,loading:t,total:o,currentPage:s,pageSize:d,searchKeyword:i,formatRole:e=>({0:"管理员",1:"歌手",2:"用户"}[e.role]||"未知"),handleSearch:()=>{s.value=1,V()},resetSearch:()=>{i.value="",s.value=1,V()},fresh:()=>{V()},toggleUserStatus:async e=>{var a,r,l,t,o;try{await C.confirm(`确定要${1===e.activation?"冻结":"解冻"}用户 "${e.username}" 吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});let s;s=1===e.activation?await w.post("/freezeUser",null,{params:{id:e.id}}):await w.post("/unfreezeUser",null,{params:{id:e.id}}),200===(null==(a=s.data)?void 0:a.code)||!0===(null==(r=s.data)?void 0:r.success)||20===(null==(l=s.data)?void 0:l.code)?(b.success((null==(t=s.data)?void 0:t.message)||(1===e.activation?"冻结":"解冻")+"成功"),V()):b.error((null==(o=s.data)?void 0:o.message)||(1===e.activation?"冻结":"解冻")+"失败")}catch(s){"cancel"===s||b.error("操作失败")}},handleSizeChange:e=>{d.value=e,s.value=1,V()},handleCurrentChange:e=>{s.value=e,V()},dialogVisible:n,dialogTitle:u,userForm:p,userFormRef:m,formRules:f,showAddForm:()=>{c.value=!1,u.value="添加歌手",_(),p.role="1",n.value=!0},showEditForm:e=>{c.value=!0,u.value="编辑歌手",Object.assign(p,e),n.value=!0},submitForm:async()=>{m.value&&(c.value?(f.password=[],f.confirmPassword=[]):(f.password=[{required:!0,validator:g,trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],f.confirmPassword=[{required:!0,validator:v,trigger:"blur"}]),await m.value.validate((async e=>{var a,r,l,t;if(!e)return!1;try{let e,o={...p};if(c.value||o.id)delete o.password,delete o.confirmPassword,e=await h(o.id,o);else{const a={username:p.username,email:p.email,phone:p.phone,password:p.password,role:"1"};e=await y(a)}20===(null==(a=e.data)?void 0:a.code)||!0===(null==(r=e.data)?void 0:r.success)?(b.success((null==(l=e.data)?void 0:l.message)||(c.value?"更新成功":"添加成功")),n.value=!1,V()):b.error((null==(t=e.data)?void 0:t.message)||(c.value?"更新失败":"添加失败"))}catch(o){b.error("操作失败")}})))},deleteUser:async e=>{try{await C.confirm(`确定要删除用户 "${e.username}" 吗？此操作不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"});const a=await w.post("/deleteUser",null,{params:{userId:e.id}});200===a.code||!0===a.success?(b.success(a.message||"删除成功"),V()):b.error(a.message||"删除失败")}catch(a){"cancel"!==a&&b.error("删除失败")}},isEditMode:c}}},[["render",function(e,a,r,h,f,w){const y=l("el-button"),b=l("el-input"),C=l("el-table-column"),k=l("el-image"),z=l("el-tag"),P=l("el-table"),S=l("el-pagination"),E=l("el-card"),j=l("el-form-item"),q=l("el-form"),R=l("el-dialog"),T=t("loading");return o(),s("div",V,[d(E,null,{default:i((()=>[n("div",_,[a[11]||(a[11]=n("h2",null,"歌手管理",-1)),d(y,{type:"primary",onClick:h.showAddForm},{default:i((()=>[...a[10]||(a[10]=[u("添加歌手",-1)])])),_:1},8,["onClick"])]),n("div",x,[d(b,{modelValue:h.searchKeyword,"onUpdate:modelValue":a[0]||(a[0]=e=>h.searchKeyword=e),placeholder:"请输入歌手名进行搜索",style:{width:"300px","margin-right":"10px"},clearable:"",onKeyup:m(h.handleSearch,["enter"])},null,8,["modelValue","onKeyup"]),d(y,{type:"primary",onClick:h.handleSearch},{default:i((()=>[...a[12]||(a[12]=[u("搜索",-1)])])),_:1},8,["onClick"]),d(y,{onClick:h.resetSearch},{default:i((()=>[...a[13]||(a[13]=[u("重置",-1)])])),_:1},8,["onClick"]),d(y,{onClick:h.fresh},{default:i((()=>[...a[14]||(a[14]=[u("刷新",-1)])])),_:1},8,["onClick"])]),c((o(),p(P,{data:h.userList,style:{width:"100%","margin-top":"20px"},"default-sort":{prop:"id",order:"ascending"}},{default:i((()=>[d(C,{prop:"id",label:"ID",width:"50"}),d(C,{prop:"username",label:"用户名",width:"120"}),d(C,{label:"用户头像",width:"150"},{default:i((({row:e})=>[e.imageUrl?(o(),p(k,{key:0,src:e.imageUrl,"preview-src-list":[e.imageUrl],fit:"cover",style:{width:"80px",height:"80px","border-radius":"4px"}},null,8,["src","preview-src-list"])):(o(),s("span",F,"-"))])),_:1}),d(C,{prop:"email",label:"邮箱",width:"200"}),d(C,{prop:"phone",label:"手机号",width:"130"}),d(C,{prop:"role",label:"角色",formatter:h.formatRole,width:"80"},null,8,["formatter"]),d(C,{prop:"activation",label:"状态",width:"80"},{default:i((({row:e})=>[d(z,{type:1===e.activation?"success":"danger"},{default:i((()=>[u(g(1===e.activation?"正常":"冻结"),1)])),_:2},1032,["type"])])),_:1}),d(C,{prop:"createTime",label:"创建时间",width:"160"}),d(C,{label:"操作",width:"220"},{default:i((({row:e})=>[d(y,{size:"small",type:"primary",onClick:a=>h.showEditForm(e),style:{"margin-right":"5px"}},{default:i((()=>[...a[15]||(a[15]=[u(" 编辑 ",-1)])])),_:1},8,["onClick"]),d(y,{size:"small",type:1===e.activation?"danger":"success",onClick:a=>h.toggleUserStatus(e),style:{"margin-right":"5px"}},{default:i((()=>[u(g(1===e.activation?"冻结":"解冻"),1)])),_:2},1032,["type","onClick"])])),_:1})])),_:1},8,["data"])),[[T,h.loading]]),d(S,{"current-page":h.currentPage,"onUpdate:currentPage":a[1]||(a[1]=e=>h.currentPage=e),"page-size":h.pageSize,"onUpdate:pageSize":a[2]||(a[2]=e=>h.pageSize=e),"page-sizes":[5,10,20,50,100],total:h.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:h.handleSizeChange,onCurrentChange:h.handleCurrentChange,style:{"margin-top":"20px","justify-content":"center"}},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])),_:1}),d(R,{modelValue:h.dialogVisible,"onUpdate:modelValue":a[9]||(a[9]=e=>h.dialogVisible=e),title:h.dialogTitle,width:"500px"},{footer:i((()=>[n("span",U,[d(y,{onClick:a[8]||(a[8]=e=>h.dialogVisible=!1)},{default:i((()=>[...a[16]||(a[16]=[u("取消",-1)])])),_:1}),d(y,{type:"primary",onClick:h.submitForm},{default:i((()=>[...a[17]||(a[17]=[u("确定",-1)])])),_:1},8,["onClick"])])])),default:i((()=>[d(q,{ref:"userFormRef",model:h.userForm,rules:h.formRules,"label-width":"80px"},{default:i((()=>[d(j,{label:"用户名",prop:"username"},{default:i((()=>[d(b,{modelValue:h.userForm.username,"onUpdate:modelValue":a[3]||(a[3]=e=>h.userForm.username=e),placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),d(j,{label:"邮箱",prop:"email"},{default:i((()=>[d(b,{modelValue:h.userForm.email,"onUpdate:modelValue":a[4]||(a[4]=e=>h.userForm.email=e),placeholder:"请输入邮箱",type:"email"},null,8,["modelValue"])])),_:1}),d(j,{label:"手机号",prop:"phone"},{default:i((()=>[d(b,{modelValue:h.userForm.phone,"onUpdate:modelValue":a[5]||(a[5]=e=>h.userForm.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])])),_:1}),h.isEditMode?v("",!0):(o(),p(j,{key:0,label:"密码",prop:"password"},{default:i((()=>[d(b,{modelValue:h.userForm.password,"onUpdate:modelValue":a[6]||(a[6]=e=>h.userForm.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1})),h.isEditMode?v("",!0):(o(),p(j,{key:1,label:"确认密码",prop:"confirmPassword"},{default:i((()=>[d(b,{modelValue:h.userForm.confirmPassword,"onUpdate:modelValue":a[7]||(a[7]=e=>h.userForm.confirmPassword=e),type:"password",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])])),_:1}))])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}],["__scopeId","data-v-d6a1387a"]]);export{k as default};
