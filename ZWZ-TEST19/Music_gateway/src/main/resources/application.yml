# Spring Boot 应用配置
spring:
  # 应用名称
  application:
    name: Music_gateway
  cloud:
    # Nacos 服务发现配置
    nacos:
      discovery:
        server-addr: localhost:8848  # Nacos 服务器地址
        namespace: public            # 命名空间
    # Spring Cloud Gateway 配置
    gateway:
      routes:
        # 管理模块路由
        - id: mod_admin
          uri: http://localhost:8081
          predicates:
            - Path=/admin/**
          filters:
            - PreserveHostHeader
            - AddResponseHeader=X-Debug-Info, Gateway-Route-Working
        
        - id: mod_like
          uri: http://localhost:8082
          predicates:
            - Path=/like/**
          filters:
            - PreserveHostHeader
            - AddResponseHeader=X-Debug-Info, Gateway-Route-Working
        
        # 登录模块路由 - 匹配 /login/ 开头的子路径（排除精确的 /login 页面路由）
        - id: mod_login
          uri: http://localhost:8083
          predicates:
            - Path=/login/*,/login/**,/register/**
          filters:
            - PreserveHostHeader
            - AddResponseHeader=X-Debug-Info, Gateway-Route-Working
        
        - id: mod_msg
          uri: http://localhost:8084
          predicates:
            - Path=/msg/**
          filters:
            - PreserveHostHeader
            - AddResponseHeader=X-Debug-Info, Gateway-Route-Working
        
        - id: mod_music
          uri: http://localhost:8085
          predicates:
            - Path=/music/**
          filters:
            - PreserveHostHeader
            - AddResponseHeader=X-Debug-Info, Gateway-Route-Working
        
        - id: mod_setting
          uri: http://localhost:8086
          predicates:
            - Path=/setting/**
          filters:
            - PreserveHostHeader
            - AddResponseHeader=X-Debug-Info, Gateway-Route-Working
        
        # 歌手模块路由 - 匹配 /singer/ 开头的子路径（排除精确的 /singer 页面路由）
        - id: mod_singer
          uri: http://localhost:8087
          predicates:
            - Path=/singer/*,/singer/**
          filters:
            - PreserveHostHeader
        
        - id: mod_songList
          uri: http://localhost:8088
          predicates:
            - Path=/songList/**
          filters:
            - PreserveHostHeader
        
        - id: mod_upload
          uri: http://localhost:8089
          predicates:
            - Path=/upload/**
          filters:
            - PreserveHostHeader
        
        # 前端静态资源路由 - 匹配所有请求
        - id: frontend
          uri: http://localhost:5173
          predicates:
            - Path=/**
          filters:
            - RewritePath=/(?<segment>.*), /${segment}
            - PreserveHostHeader

      # 全局CORS配置
      globalcors:
        cors-configurations:
          '[/**]': # 匹配所有路径
            allowedOrigins: "*"   # 允许所有来源域名
            allowedMethods: "*"   # 允许所有HTTP方法
            allowedHeaders: "*"   # 允许所有请求头
            allowCredentials: true  # 允许发送Cookie等凭证
# 服务器配置
server:
  port: 8080  # 网关服务端口
# 详细的日志配置
logging:
  level:
    root: INFO
    org.springframework.cloud.gateway: TRACE
    org.springframework.web.reactive: TRACE
    reactor.netty: TRACE
    reactor.netty.http.client: TRACE
    org.springframework.cloud.gateway.filter.NettyRoutingFilter: TRACE
    org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator: TRACE
